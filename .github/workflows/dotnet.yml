name: .Net

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
env:
  buildConfiguration: 'Release' 
  GITHUB_SHA: ${{ github.sha }}
  SERVICE_NAME: sample-dotnet-app
  REGISTRY_HOSTNAME: ecr
  ENV: dev

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Setup .NET
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 2.2.103
    - name: Build
      run: |
          dotnet build --configuration $buildConfiguration
          dotnet test dotnetcore-tests --configuration $buildConfiguration --logger trx
          dotnet publish --configuration $buildConfiguration --output out
    - name: Test Report
      uses: zyborg/dotnet-tests-report@v1.0.0
      with:
        project_path: "**/*.trx"
        report_name: Unit_Tests
        report_title: My Project Tests
        github_token: ${{ secrets.GITHUB_TOKEN }}
    - name: Build and push
      id: docker_build
      uses: docker/build-push-action@v2
      with:
        context: .
        file: ./Dockerfile
        push: false
        tags: ${{ steps.docker_meta.outputs.tags }}
        labels: ${{ steps.docker_meta.outputs.labels }}
    
    
